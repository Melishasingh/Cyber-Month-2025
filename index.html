<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyber Month Chronicles: Operation Datafall</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto Mono', monospace;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
        }
        h1, h2, button, input {
            font-family: 'Share Tech Mono', monospace;
        }
        .text-glow {
            text-shadow: 0 0 8px rgba(0, 255, 255, 0.6);
        }
        .button-glow {
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.4), 0 0 16px rgba(0, 255, 255, 0.2);
            transition: all 0.3s ease-in-out;
        }
        .button-glow:hover {
            box-shadow: 0 0 12px rgba(0, 255, 255, 0.8), 0 0 24px rgba(0, 255, 255, 0.4);
            transform: translateY(-2px);
        }
        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.4),
                rgba(0, 0, 0, 0.4) 1px,
                transparent 1px,
                transparent 4px
            );
            pointer-events: none;
            z-index: 10;
        }
        #story {
            white-space: pre-wrap; /* Preserves formatting for story text */
        }
        .character-card {
            border: 2px solid rgba(0, 255, 255, 0.2);
            background-color: rgba(9, 10, 15, 0.5);
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }
        .character-card:hover {
            border-color: rgba(0, 255, 255, 0.7);
            transform: scale(1.05);
        }
    </style>
</head>
<body class="text-gray-200 flex items-center justify-center min-h-screen p-4">
    <div class="scanlines"></div>
    <div id="game-container" class="w-full max-w-3xl mx-auto rounded-2xl shadow-2xl shadow-cyan-500/10 p-6 md:p-8 relative z-20">
        
        <header class="text-center mb-6 border-b border-cyan-400/20 pb-4">
            <h1 class="text-3xl md:text-4xl font-bold text-cyan-300 text-glow">Cyber Month Chronicles</h1>
            <h2 id="subtitle" class="text-lg text-gray-300 mt-1">Operation: Datafall</h2>
        </header>

        <main>
            <div id="character-selection" class="text-center">
                <p class="text-xl mb-6">A new threat is emerging. Choose your agent:</p>
                <div class="grid md:grid-cols-3 gap-6">
                    <div id="char-alex" class="character-card p-6 rounded-lg cursor-pointer">
                        <h3 class="text-2xl font-bold text-cyan-400">Alex</h3>
                        <p class="mt-2 text-sm">The Veteran Agent. Experienced and methodical, but sometimes over-reliant on old tricks.</p>
                    </div>
                    <div id="char-ben" class="character-card p-6 rounded-lg cursor-pointer">
                        <h3 class="text-2xl font-bold text-cyan-400">Ben</h3>
                        <p class="mt-2 text-sm">The Eager Intern. A tech prodigy, but his trusting nature could be his downfall.</p>
                    </div>
                    <div id="char-chloe" class="character-card p-6 rounded-lg cursor-pointer">
                        <h3 class="text-2xl font-bold text-cyan-400">Chloe</h3>
                        <p class="mt-2 text-sm">The Remote Consultant. A master of digital forensics, but works from a home network.</p>
                    </div>
                </div>
            </div>

            <div id="story-container" style="display: none;">
                <div id="story" class="text-lg leading-relaxed mb-8 min-h-[200px] bg-black/20 p-4 rounded-md border border-gray-700">
                    <!-- Story text will be injected here -->
                </div>
                <div id="choices" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Choice buttons will be injected here -->
                </div>
                <div id="outcome" class="mt-6 text-center font-semibold p-4 rounded-lg" style="display: none;">
                    <!-- Consequence/explanation text will be injected here -->
                </div>
                <div id="report-container" class="mt-6 text-center" style="display: none;">
                     <p class="text-lg text-green-300 mb-4">Complete your mission report via the link below to be entered into our Cyber Month raffle!</p>
                    <a id="report-button" href="#" target="_blank" class="w-full max-w-sm mx-auto text-center p-4 rounded-lg bg-green-500/10 border-2 border-green-400/30 hover:bg-green-500/30 focus:ring-2 focus:ring-green-300 focus:outline-none button-glow">
                        Log Mission Report
                    </a>
                </div>
            </div>
        </main>
    </div>

    <script>
        // DOM Elements
        const characterSelection = document.getElementById('character-selection');
        const storyContainer = document.getElementById('story-container');
        const storyElement = document.getElementById('story');
        const choicesElement = document.getElementById('choices');
        const outcomeElement = document.getElementById('outcome');
        const subtitle = document.getElementById('subtitle');
        const reportContainer = document.getElementById('report-container');
        const reportButton = document.getElementById('report-button');

        // Game State Variables
        let gameState = {};
        const storageKey = 'cyberAdventureGameState';

        // --- Local Storage Functions ---
        function saveGameState() {
            localStorage.setItem(storageKey, JSON.stringify(gameState));
        }

        function loadGameState() {
            const savedState = localStorage.getItem(storageKey);
            if (savedState) {
                gameState = JSON.parse(savedState);
                
                // If game is in progress, jump right in
                if (gameState.character && gameState.currentNode) {
                    characterSelection.style.display = 'none';
                    storyContainer.style.display = 'block';
                    subtitle.textContent = `Character: ${gameState.character}`;
                    showNode(gameState.currentNode, false);
                } 
            }
        }
        
        function deleteGameState() {
            localStorage.removeItem(storageKey);
            gameState = {};
        }

        // --- Game Story Data ---
        const story = {
            start: {
                text: `The briefing was grim. A cyber-espionage group, 'The Digital Phantoms', has launched 'Operation Datafall'. Their goal: infiltrate corporate networks through their weakest linkâ€”people.

Your terminal chimes. It's an encrypted message from HQ: "PHANTOM ACTIVITY DETECTED. ALL AGENTS ON HIGH ALERT."

Just then, your phone buzzes. A text from an unknown number: "URGENT: Corporate account breach detected. Tap to secure your account now: [corporate-secure-login.com]"`,
                choices: [
                    { text: "Tap the link. It could be real.", next: 'phishingFail' },
                    { text: "Analyze the link's metadata first.", next: 'phishingAnalyze' },
                    { text: "Forward the text to the IT Security team's public submission portal.", next: 'phishingReport' }
                ]
            },
            phishingFail: {
                text: `You tap the link. A perfect replica of your company's login page appears. You enter your credentials. The page reloads with an error... but it's too late. Your endpoint protection software screams a notification: "Malware Detected: 'PhantomKey' keylogger installed."

The Digital Phantoms have your password. They are inside.

<strong class="text-red-400">MISSION FAILURE</strong>`,
                outcome: { text: "This was a sophisticated phishing attack. Tapping the link directly was a critical error.", style: "bg-red-900/50 text-red-300 border border-red-500/30", result: "Failure - Phishing" },
                choices: [{ text: "Restart the Mission", next: 'restart' }]
            },
            phishingAnalyze: {
                text: `You copy the link without opening it and run it through a link analyzer. The results are chilling: the domain was registered just hours ago, and it's routing through servers in a known rogue state. It's a clear phishing attempt.

As you blacklist the domain, your work laptop flashes a bright red notification: 'SYSTEM UPDATE REQUIRED. Your endpoint protection software is out of date.' You're in the middle of compiling critical intelligence on the Phantoms.`,
                choices: [
                    { text: "Ignore it for now. The intel is too important.", next: 'updateFail' },
                    { text: "Start the update. A secure endpoint is non-negotiable.", next: 'updateSuccess' }
                ]
            },
            phishingReport: {
                text: `Excellent protocol. You forward the message to the security team. Within minutes, an automated response confirms it's a known phishing campaign. A company-wide alert is issued, neutralizing the threat. Your quick thinking has protected hundreds.

Your focus returns to your laptop, which is displaying a persistent notification: 'SYSTEM UPDATE REQUIRED. Your endpoint protection software is out of date.'`,
                choices: [
                    { text: "I'll do it later. This can't be as urgent as the Phantoms.", next: 'updateFail' },
                    { text: "Save work and initiate the update.", next: 'updateSuccess' }
                ]
            },
            updateFail: {
                text: `You dismiss the notification, focusing on your report. Suddenly, your screen flickers. A message appears, written in crude green text: "WE ARE THE PHANTOMS. YOUR FIREWALL IS OURS."

The DataWorm malware exploited the very vulnerability the update was meant to patch. Your machine is compromised.

<strong class="text-red-400">MISSION FAILURE</strong>`,
                outcome: { text: "Critical security updates patch known vulnerabilities that attackers are actively exploiting. Delaying them is a gamble you lost.", style: "bg-red-900/50 text-red-300 border border-red-500/30", result: "Failure - Delayed Update" },
                choices: [{ text: "Restart the Mission", next: 'restart' }]
            },
            updateSuccess: {
                text: `You run the update. It takes 15 minutes, but your endpoint protection is now patched and running a deep scan. The system is secure.

You decide to take a short break and work from a nearby cafe to change your environment. The cafe offers free public Wi-Fi. Your phone has a strong 5G signal.`,
                choices: [
                    { text: "Connect to the cafe's public Wi-Fi.", next: 'wifiFail' },
                    { text: "Use your phone's 5G as a secure hotspot.", next: 'hotspotSuccess' }
                ]
            },
            wifiFail: {
                 text: `You connect to "Cafe_Guest_WiFi". A few minutes into your work, a pop-up asks you to install a "network driver" to improve speed. It seems plausible. You click install.

Your screen freezes, then displays the Phantom's logo. The public Wi-Fi was a trapâ€”a 'man-in-the-middle' attack. They intercepted your connection and pushed malware to your device.

<strong class="text-red-400">MISSION FAILURE</strong>`,
                 outcome: { text: "Public Wi-Fi is inherently insecure. Attackers can create fake hotspots or monitor unencrypted traffic. Never install software prompted by a public network.", style: "bg-red-900/50 text-red-300 border border-red-500/30", result: "Failure - Public Wi-Fi" },
                 choices: [{ text: "Restart the Mission", next: 'restart' }]
            },
            hotspotSuccess: {
                text: `You wisely tether to your phone's encrypted 5G network, bypassing the insecure public Wi-Fi. As you're working, you spot a USB flash drive on the floor, labeled "Q4 Executive Bonuses."

It's tempting. This could hold valuable intel, or it could be a trap.`,
                choices: [
                    { text: "Plug it into your laptop. You have to know what's on it.", next: 'usbFail' },
                    { text: "Leave it. It's too much of a risk.", next: 'usbSuccess' },
                    { text: "Take it to an isolated IT sandbox for analysis.", next: 'victory' }
                ]
            },
            usbFail: {
                text: `The moment you plug the USB into your machine, the autorun function executes a malicious payload. Your keyboard and mouse lock up. The Phantoms' skull logo fills your screen.

It was a 'USB drop' attack, one of the oldest tricks in the book.

<strong class="text-red-400">MISSION FAILURE</strong>`,
                outcome: { text: "Never plug in a found USB drive. They are a common vector for malware that can execute automatically, bypassing some security measures.", style: "bg-red-900/50 text-red-300 border border-red-500/30", result: "Failure - USB Drop" },
                choices: [{ text: "Restart the Mission", next: 'restart' }]
            },
            usbSuccess: {
                text: `You correctly identify the USB drive as a major security risk and leave it untouched. While you've avoided a direct threat, you can't shake the feeling you've left a piece of the puzzle behind.

You've protected your device, but the Phantoms' broader plan remains a mystery. You've survived, but the war isn't over.

<strong class="text-amber-400">MISSION SURVIVAL</strong>`,
                outcome: { text: "You made a safe choice, but a great agent turns a threat into an opportunity. The best path was to analyze the drive in a secure environment.", style: "bg-amber-900/50 text-amber-300 border border-amber-500/30", result: "Survival - Avoided USB" },
                choices: [{ text: "Play Again", next: 'restart' }]
            },
            victory: {
                text: `This is the move of a master agent. You take the USB drive to an IT lab with a sandboxed, air-gapped PC. Upon analysis, the drive contains not only malware, but also a file that, when decrypted, reveals the location of the Digital Phantoms' primary command server.

You've not only defended against their attack, you've given HQ the key to dismantling their entire operation.

<strong class="text-cyan-300 text-glow">MISSION ACCOMPLISHED!</strong>`,
                outcome: { text: "Exceptional work, Agent! You navigated every threat with skill and turned the enemy's weapon against them. You didn't just protect the data; you defeated the threat.", style: "bg-cyan-900/50 text-cyan-300 border border-cyan-500/30", result: "Victory" },
                choices: [{ text: "Play Again", next: 'restart' }]
            }
        };

        // --- Game Logic Functions ---
        function selectCharacter(name) {
            gameState.character = name;
            characterSelection.style.display = 'none';
            storyContainer.style.display = 'block';
            subtitle.textContent = `Character: ${gameState.character}`;
            showNode('start');
        }

        function showNode(nodeKey, shouldSave = true) {
            if (nodeKey === 'restart') {
                deleteGameState();
                characterSelection.style.display = 'block';
                storyContainer.style.display = 'none';
                subtitle.textContent = 'Operation: Datafall';
                return;
            }

            const node = story[nodeKey];
            storyElement.innerHTML = node.text;
            gameState.currentNode = nodeKey;


            while (choicesElement.firstChild) {
                choicesElement.removeChild(choicesElement.firstChild);
            }

            if (node.outcome) {
                outcomeElement.innerHTML = node.outcome.text;
                outcomeElement.className = `mt-6 text-center font-semibold p-4 rounded-lg ${node.outcome.style}`;
                outcomeElement.style.display = 'block';
                
                // --- Reporting Logic ---
                reportContainer.style.display = 'block';
                // Link to the user-provided Google Form
                const baseURL = "https://docs.google.com/forms/d/e/1FAIpQLSccG1sMooAvRPDsnoHc4DSfFEjgAdosn18oPE-FkwaHb-VR5w/viewform?usp=pp_url";
                const characterParam = `&entry.1481525413=${encodeURIComponent(gameState.character)}`;
                const resultParam = `&entry.149815048=${encodeURIComponent(node.outcome.result)}`;
                reportButton.href = baseURL + characterParam + resultParam;

            } else {
                outcomeElement.style.display = 'none';
                reportContainer.style.display = 'none';
            }

            node.choices.forEach(choice => {
                const button = document.createElement('button');
                button.innerHTML = choice.text;
                button.className = `w-full text-center p-4 rounded-lg bg-cyan-500/10 border-2 border-cyan-400/30 hover:bg-cyan-500/30 focus:ring-2 focus:ring-cyan-300 focus:outline-none button-glow`;
                button.addEventListener('click', () => showNode(choice.next));
                choicesElement.appendChild(button);
            });

            if (shouldSave) {
                saveGameState();
            }
        }

        // --- Event Listeners ---
        document.getElementById('char-alex').addEventListener('click', () => selectCharacter('Alex'));
        document.getElementById('char-ben').addEventListener('click', () => selectCharacter('Ben'));
        document.getElementById('char-chloe').addEventListener('click', () => selectCharacter('Chloe'));

        // --- Initial Load ---
        window.addEventListener('load', loadGameState);

    </script>
</body>
</html>
